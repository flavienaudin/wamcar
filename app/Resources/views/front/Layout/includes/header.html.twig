{% set is_home_page = is_home_page|default(false) %}
{% set isUserPro = isUserPro|default(false) %}
{% set header_class = header_class|default('') %}

{% set userUnseenNotificationCount = isLogged ? mgilet_notification_unseen_count(app.user) : null %}

<header id="js-header" class="l-header column small-right-collapse xlarge-right-uncollapse {{ header_class }}">

    {% include "front/Layout/includes/logo.html.twig" %}

    {% block header_center %}
        {% if isUserPro %}
            {% include "front/Layout/includes/navigation/primary_pro.html.twig" %}
        {% elseif isUserPersonal %}
            {% include "front/Layout/includes/navigation/primary_personal.html.twig" %}
        {% else %}
            {% include "front/Layout/includes/navigation/primary.html.twig" %}
        {% endif %}
    {% endblock %}

    <div class="l-header-right block-grid column small-collapse small-right shrink xlarge-uncollapse {{ is_register_page ? 'is-hidden' : '' }}">
        {% block header_right %}
            {% if isLogged %}
                <a href="{{ mgilet_notification_generate_path('notification_list', app.user) }}" class="l-navigation-item is-logged l-header-button icon-bell body-font-color l-header-button show-for-small-only">
                    <span class="messages-notification">{{ userUnseenNotificationCount }}</span>
                </a>
                <button class="l-navigation-item is-logged l-header-button icon-bell body-font-color l-header-button show-for-medium"
                        data-toggle="notifications-dropdown">
                    <span class="messages-notification">{{ userUnseenNotificationCount }}</span>
                </button>

                <ul class="dropdown menu" data-dropdown-menu>
                    <li class="is-flex">
                        <a href="#" class="l-navigation-item is-logged l-header-button body-font-color icon-avatar is-logo brand-logo-rounded">
                            <img src="{{ app.user.avatar|avatar('user_mini_thumbnail') }}" alt="{{ app.user.fullName }}"
                                 title="{{ app.user.firstName }}">
                            <b class="show-for-xlarge">&nbsp;{{ app.user.firstName }}</b>
                        </a>
                        <ul class="menu is-dropdown-submenu">
                            {% if isUserPro %}
                                <li><a href="{{ path('front_view_current_user_info') }}">{{ 'header.pro.my_profile'|trans }}</a></li>
                                {% if not app.user.hasGarage %}
                                    <li><a href="{{ path('front_garage_create') }}">{{ 'header.pro.my_garage'|trans }}</a></li>
                                {% elseif app.user.garageMemberships|length == 1 %}
                                    <li><a href="{{ path('front_garage_view', {'id': app.user.garageMemberships.first.garage.id}) }}">{{ 'header.pro.my_garage'|trans }}</a></li>
                                {% else %}
                                    <li>
                                        <a href="#">{{ 'header.pro.my_garages'|trans }}</a>
                                        <ul class="menu">
                                            {% for garageMemberShip in app.user.garageMemberships %}
                                                <li><a href="{{ path('front_garage_view', {'id': garageMemberShip.garage.id}) }}" class="logo-garage">
                                                    <img src="{{ garageMemberShip.garage|logo('garage_mini_logo') }}" class="small-2 logo-mini align-self-top" alt="Logo {{ garageMemberShip.garage.name }}">
                                                            &nbsp;{{ garageMemberShip.garage.name}} - {{ garageMemberShip.garage.city.name}}
                                                    </a></li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endif %}
                                {% if not app.user.garage %}
                                    {# Astuce : Pas de possibilité d'ajouter un véhicule avant d'avoir créer le garage => Redirection vers page de création d'un garage avec message dans l'action #}
                                    <li><a href="{{ path('front_vehicle_pro_add', {'garage_id':0}) }}">{{ 'header.anonyme.sell'|trans }}</a></li>
                                {% elseif app.user.garageMemberships|length == 1 %}
                                    <li><a href="{{ path('front_vehicle_pro_add', {'garage_id': app.user.garageMemberships.first.garage.id}) }}">{{ 'header.anonyme.sell'|trans }}</a></li>
                                {% else %}
                                    <li>
                                        <a href="#" >{{ 'header.anonyme.sell'|trans }}</a>
                                        <ul class="menu">
                                            {% for garageMemberShip in app.user.garageMemberships %}
                                                <li><a href="{{ path('front_vehicle_pro_add', {'garage_id': garageMemberShip.garage.id}) }}" class="logo-garage">
                                                        <img src="{{ garageMemberShip.garage|logo('garage_mini_logo') }}" class="small-2 logo-mini align-self-top" alt="Logo {{ garageMemberShip.garage.name }}">
                                                        &nbsp;{{ garageMemberShip.garage.name}} - {{ garageMemberShip.garage.city.name}}
                                                    </a></li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endif%}
                                <li><a href="{{ path('front_search_tab_personal') }}">{{ 'header.anonyme.see_search'|trans }}</a></li>
                            {% elseif isUserPersonal%}
                                <li><a href="{{ path('front_view_current_user_info',{'_fragment':'user_project_section'}) }}">{{ 'header.personal.my_add'|trans }}</a></li>
                                <li><a href="{{ path('front_edit_user_info') }}">{{ 'header.personal.profile_edit'|trans }}</a></li>
                                <li><a href="{{ path('front_edit_user_project') }}">{{ 'header.personal.project_edit'|trans }}</a></li>
                                <li><a href="{{ path('front_view_current_user_info',{'_fragment':'user_vehicles_section'}) }}">{{ 'header.personal.my_vehicles'|trans }}</a></li>
                                <li><a href="{{ path('front_vehicle_personal_add') }}">{{ 'header.personal.add_vehicle'|trans }}</a></li>
                            {% endif %}
                            <li class="menu-separator"></li>
                            <li><a href="{{ path('security_logout') }}">{{ 'global.button.logout'|trans }}</a></li>
                        </ul>
                    </li>
                </ul>
            {% else %}
                <button type="button" class="l-header-button icon-user small-right" id="open-side-login" data-toggle="js-off-canvas-user" title="{{ 'header.anonyme.log'|trans }}">
                    <span class="show-for-xlarge">{{ 'header.anonyme.log'|trans }}</span>
                </button>
                <button class="l-header-button hamburger primary-color hide-for-large" data-toggle="js-off-canvas-navigation">
                    <span class="hamburger-line"></span>
                </button>
            {% endif %}
        {% endblock %}
    </div>
</header>

{% if isLogged %}
    <div class="dropdown-pane dropdown-pane-notifications show-for-medium" id="notifications-dropdown" data-dropdown
         data-position="bottom" data-alignment="right" data-auto-focus="true">
        {{ mgilet_notification_render(app.user, {'seen': true, 'template':'front/Notifications/includes/notifications.html.twig', 'order':'desc'}) }}
    </div>
{% else %}
    <div id="js-off-canvas-user" class="off-canvas position-right is-closed" data-content-scroll="false"
         aria-hidden="true" data-off-canvas>
        {% include 'front/Layout/includes/off_canvas_user.html.twig' %}
    </div>
    <div id="js-off-canvas-navigation" class="off-canvas position-right is-closed off-canvas-navigation "
         data-content-scroll="false" aria-hidden="true" data-off-canvas></div>
{% endif %}
