{% extends 'front/Layout/layout.html.twig' %}

{% block mainClass %}no-padding-top{% endblock %}

{% block title %}{{ "pro_user_performances.page.title"|trans }}{% endblock %}

{% set breadcrumbs = [
    {
        'name': block('title'),
        'href': app.request.requestUri
    }
] %}

{% block body %}
    {% include 'front/Layout/includes/breadcrumb.html.twig' %}

    {% include 'front/Layout/includes/page_header.html.twig' with {
        title: block('title')
    } %}


    <div class="row">
        <div class="column small-12">
            <h2>Mes performances sur les 30 derniers jours</h2>
            <div class="row">
                <div class="column block-grid small-12 large-4">
                    <table class="perf-audience-datatable dataTable compact row-border">
                        <thead>
                        <tr>
                            <th class="text-center black-color" colspan="2"><h3 class="no-margin">Mon audience</h3></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th>#Vues de votre page profil</th>
                            <td>{{ performances.nbUniqueViewsOfProfilePage }}</td>
                        </tr>
                        <tr>
                            <th>#click numéro téléphone</th>
                            <td>{{ performances.nbPhoneNumberDisplays }}</td>
                        </tr>
                        <tr>
                            <th>#messages reçus</th>
                            <td>{{ performances.nbReceivedMessages }}</td>
                        </tr>
                        <tr>
                            <th>#likes reçus</th>
                            <td>{{ performances.nbReceivedLikes }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="column block-grid small-12 large-4">
                    <table class="perf-activity-datatable dataTable compact row-border">
                        <thead>
                        <tr>
                            <th class="text-center black-color" colspan="2"><h3 class="no-margin">Mon activité</h3></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th>#Messages envoyés</th>
                            <td>{{ performances.nbSentMessages }}</td>
                        </tr>
                        <tr>
                            <th>#likes envoyés</th>
                            <td>{{ performances.nbSentLikes }}</td>
                        </tr>
                        {#<tr>
                            <th>#appels ? (affichage numéro)</th>
                            <td>{{ performances. }}</td>
                        </tr>#}
                        <tr>
                            <th>#leads</th>
                            <td>{{ performances.nbLeads }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="column block-grid small-12 large-4">
                    <table class="perf-results-datatable dataTable compact row-border">
                        <thead>
                        <tr>
                            <th class="text-center black-color" colspan="2"><h3 class="no-margin">Mes résultats</h3>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th>#ventes</th>
                            <td>{{ performances.nbSales }}</td>
                        </tr>
                        <tr>
                            <th>#Reprises</th>
                            <td>{{ performances.nbPartExchanges }}</td>
                        </tr>
                        <tr>
                            <th>#Total de transactions</th>
                            <td>{{ performances.nbTotalTransactions }}</td>
                        </tr>
                        <tr>
                            <th>Taux de transformation</th>
                            <td>{{ (performances.conversionRate * 100)| round }}%</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            {% if report is defined %}
                <h2>Votre page "Conseiller Automobile"</h2>
                {% set profilePagePath = path('front_view_pro_user_info', {'slug':app.user.slug}) %}
                <ul>
                    <li>Nombre de vues de votre page profil :
                        <ul>
                            <li>Les 30 derniers jours : {{ report.profilePage[0].uniquePageViews }}</li>
                            <li>Les 7 derniers jours : {{ report.profilePage[1].uniquePageViews }}</li>
                        </ul>
                    </li>
                    <li>Nombre d'affichage d'un numéro de téléphone :
                        <ul>
                            <li>Uniquement depuis votre page profil :

                                <ul>
                                    <li>Les 30 derniers jours
                                        : {{ report.contactsEvents.telephone[0].onPage[profilePagePath]??0 }} </li>
                                    <li>Les 7 derniers jours
                                        : {{ report.contactsEvents.telephone[1].onPage[profilePagePath]??0 }}</li>
                                </ul>
                            </li>
                            <li>Toutes pages confondues :
                                <ul>
                                    <li>Les 30 derniers jours : {{ report.contactsEvents.telephone[0].total??0 }} </li>
                                    <li>Les 7 derniers jours : {{ report.contactsEvents.telephone[1].total??0 }}</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>Nombre de contacts par messagerie Wamcar :
                        <ul>
                            <li>Uniquement depuis votre page profil :
                                <ul>
                                    <li>Les 30 derniers jours
                                        : {{ report.contactsEvents.message[0].onPage[profilePagePath]??0 }} </li>
                                    <li>Les 7 derniers jours
                                        : {{ report.contactsEvents.message[1].onPage[profilePagePath]??0 }}</li>
                                </ul>
                            </li>
                            <li>Toutes pages confondues :
                                <ul>
                                    <li>Les 30 derniers jours : {{ report.contactsEvents.message[0].total??0 }} </li>
                                    <li>Les 7 derniers jours : {{ report.contactsEvents.message[1].total??0 }}</li>
                                </ul>
                            </li>

                        </ul>
                    </li>
                </ul>

                <h2>Vos pages "Véhicules"</h2>
                <h3>Statistiques sur vos véhicules</h3>
                <div>
                    <ul>
                        <li>Nombre de véhicules disponibles : {{ app.user.vehicles|length }}</li>
                        <li>Top {{ report.top5Vehicles|length }} des véhicules sur les 30 derniers jours :
                            <ul>
                                {% for top5vehiclePath, top5vehicleMetrics in report.top5Vehicles %}
                                    <li>{{ top5vehiclePath }} {{ top5vehicleMetrics[0].uniquePageViews }}</li>
                                {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </div>


                <h3>Statistiques détaillées de vos pages véhicules</h3>
                {% for vehicle in app.user.vehicles %}
                    <div>
                        {% set vehiclePath = path('front_vehicle_pro_detail',{'slug':vehicle.slug}) %}
                        <h4>{{ vehicle.name|title }}
                            <small>{{ vehiclePath }}</small>
                        </h4>
                        <ul>
                            <li>Nombre de vues :
                                <ul>
                                    <li>Sur les 30 derniers jours
                                        : {{ report.vehiclesPages[vehiclePath][0].uniquePageViews??0 }}</li>
                                    <li>Sur les 7 derniers jours
                                        : {{ report.vehiclesPages[vehiclePath][1].uniquePageViews??0 }}</li>
                                </ul>
                            </li>
                            <li>Nombre de likes :
                                <ul>
                                    <li>Total : {{ vehicle.positiveLikes|length }}</li>
                                    {# Pas de données GA car non tracké : l'action est redirigée
                                    <li>Sur les 30 derniers jours : {{ report.vehiclesLikes[vehiclePath][0]??0 }}</li>
                                    <li>Sur les 7 derniers jours : {{ report.vehiclesLikes[vehiclePath][1]??0 }}</li>#}
                                </ul>
                            </li>
                            <li>Nombre de contacts :
                                <ul>
                                    <li>Téléphone :
                                        <ul>
                                            <li>Les 30 derniers jours
                                                : {{ report.contactsEvents.telephone[0].onPage[vehiclePath]??0 }} </li>
                                            <li>Les 7 derniers jours
                                                : {{ report.contactsEvents.telephone[1].onPage[vehiclePath]??0 }}</li>
                                        </ul>
                                    </li>
                                    <li>Message :
                                        <ul>
                                            <li>Les 30 derniers jours
                                                : {{ report.contactsEvents.message[0].onPage[vehiclePath]??0 }} </li>
                                            <li>Les 7 derniers jours
                                                : {{ report.contactsEvents.message[1].onPage[vehiclePath]??0 }}</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
{% endblock %}